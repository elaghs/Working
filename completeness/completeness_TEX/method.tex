\newcommand{\minproofcov}{\text{\sc MinProof-Cov}}


\section{Proof-Based Metrics}
\label{sec:method}

In this section, we propose a new approach for measuring property completeness based on proof rather than mutation.  We first define notation, then describe different possible metrics given a set of {\em minimal proofs}.  In this section, we do not describe how these proofs are discovered, but define an implementation for transition systems in Section~\ref{sec:impl}.
%\subsection{Coverage and Minimal Proofs}
%Alternatively, we can consider using the proofs themselves as a mechanism for determining adequacy of requirements.

\begin{definition} {\emph{IVC coverage (\ivccov):}} \\
\label{def:coverage-justi}
Given $S \in AIVC(P)$, $T_i$ is covered by $P$ via $S$ \emph{iff} $T_i \in \ivccov (P, S)$, where
$\ivccov (P, S) = \{ T_i \in T ~|~ T_i \in S \}$.
%Given $S \in AIVC(P)$, $T_i \in T$ is covered by $P$ \emph{iff} $T_i \in S$,
%denoted by $T_i \in \ivccov (P, S)$
\end{definition}
\vspace{2mm}

%For the sake of simplicity, we refer to the coverage function
%formalized in Definition \ref{def:coverage-justi} as \ivccov\.
%
We call Definition \ref{def:coverage-justi} \emph{justifiable} because, with a set of the model elements marked as covered by \ivccov, $P$ is provable, whereas a set of covered elements obtained from \nondetcov\ may not be sufficient to reconstruct the proof of the property.\footnote{\noindent ~Throughout the paper, when a coverage metric is justifiable, like \ivccov, it is said that it preserves provability of the property.}
This leads the coverage score for \ivccov\ to be usually higher than the score for \nondetcov. Coverage score for \ivccov\ can be calculated with: $$\frac{|S|}{|T|}$$
%Note that because minimal proofs are not unique, there are several possible coverage scores.
Because $P$ may have multiple IVCs, there can be a range of scores (with equal justification) for the \ivccov\ metric, which is shown by \minproofcov:
\[
   \minproofcov(T, P) = \{~\frac{ |S|}{|T|}~|~S \in AIVC(P)~\}
\]

\noindent On the other hand, if the model is {\em completely covered}, then there is only one possible minimal set: the set of all elements; in other words, all values of \ivccov\ converge for completely covered models.

Given {\em all} proofs of a particular property, it is possible to define additional, complementary coverage notions.  To do so, we first introduce categorizations of elements within proofs.
%
Considering $IVC$ and $AIVC$ relations for $P$, model elements can be categorized into one of the following groups:

\begin{itemize}
  \item \textbf{MUST} elements - target artifacts that are present in all the IVCs of a specification.
      %$$ MUST_x = \{\forall i (S_xi \in \Sigma_x) \mid \bigcap S_xi \}$$
      \[
      MUST (P) = \bigcap AIVC(P)
      \]

  \item \textbf{MAY} elements - target artifacts that are used in some, but not all, IVCs.
      \[
      MAY(P) = (\bigcup AIVC (P)) \setminus MUST (P))
      \]

  \item \textbf{IRRELEVANT} elements - target artifacts that are not in any of the IVCs.
  $$IRR(P) = T \setminus (\bigcup AIVC (P))$$
\end{itemize}

Given property $P$, functions MUST, MAY, and IRR partition the target artifacts (set $T$) into three disjoint sets \emph{must}, \emph{may}, and \emph{irrelevant}, respectively. This categorization helps to identify the role and relevance of each target artifact in satisfying a property. The \emph{must} set contains those target artifacts that are absolutely necessary for the property satisfaction.  Any change to these elements will affect provability of the property. On the other hand, any single element in the \emph{may} set may be modified without affecting provability of the property (though modifying multiple elements may require re-proof).   The \emph{irrelevant} artifacts never affect the satisfaction of the property \cite{Murugesan16:renext}.


Using the notions of $MAY$ and $MUST$, we can introduce additional coverage metrics.
%Since the primary goal of
% this paper has been to provide a complementary coverage notion in
%  formal verification, it is worth exploring other possible notions based on the idea of provability and $AIVC$, which is beneficial, as with testing, because if a coverage notion is an over-approximation, when the coverage
% is high, it does not necessarily mean the quality of
% the specification (or test suite) is high, or when it is an under-approximation, a low coverage score does not always mean the specification is of poor quality.

\begin{definition} {\emph{(\maycov):}}
  \label{def:comp-1}
 $T_i \in T$ is covered by $P$ \emph{iff} $T_i \in \maycov (P)$, where
   $\maycov (P) = \{T_i ~|~ \exists S \in AIVC(P)~.~T_i \in S \}$.
\end{definition}

\begin{definition} {\emph{(\mustcov):}}
  \label{def:mustcov}
 $T_i \in T$ is covered by $P$ \emph{iff} $T_i \in \mustcov (P)$, where
   $\mustcov (P) = \{T_i ~|~ \forall S \in AIVC(P)~.~T_i \in S \}$.
\end{definition}

The $\maycov$ notion aims to deal with the fact that a property $P$ may have
several distinct IVCs. In such cases, \ivccov\ only looks at an arbitrary IVC set
that may contain a subset of $MAY(P)$, which means, depending on
which IVC it considers, every time it may report a different part of $MAY(P)$
as uncovered. However, \maycov\ resolves this issue reporting the entire set of $MAY(P)$ as covered, which also leads to higher coverage scores.  \mustcov takes the opposite view, considering model elements covered only if they appear in all proofs.


It is possible to build still more relaxed coverage metrics in which coverage
is captured by looking at individual properties, rather than their conjunction.
%for example, in the definition of \ivccov , it is wise to look at $P$ as
%the conjunction of all properties. However, 
We can, for example, describe a metric in which any element used by an IVC for any property is considered covered.
%with this view,
%elements around IVCs that do not have common \emph{must}
%elements with others will be treated as uncovered while they are at least covered by one
% IVC of an individual property in the specification. 
%
The next definition, \allcov, formalizes this notion.

\begin{definition} {\emph{(\allcov):}}
  \label{def:comp-2}
     Given a set of properties $\Delta$ over $T$, $T_i \in T$ is covered
   \emph{iff} $T_i \in \allcov (T)$, where
   $\allcov (T) = \{T_i ~|~ (\exists P \in \Delta~.~T_i \in AIVC(P) \}$.
\end{definition}

%Considering $MAY$ and $MUST$ categorization, we can formalize another
%coverage metric that takes into account the \emph{must} set;
%however, such a metric is the same as \nondetcov\ as we discuss in the next sub-section.

\subsection{Discussion}
\label{subsec:method-disc}


Based on the categorization of elements, we will state some relationships about IVCs so to compare different proof-based metrics proposed earlier.

\begin{lemma}
  \label{lem:ivc-must-may}
 $IVC(P, S) \Rightarrow  MUST(P) \subseteq S$.
\end{lemma}
\begin{proof}
 Immediate from the definition of $AIVC$ and $MUST$.
\end{proof}
\vspace{2mm}

\begin{lemma}
  \label{lem:must-not-enough}
  If $MAY(P) \neq \varnothing$, then $P$ is not provable by $MUST(P)$.
\end{lemma}
\begin{proof}
  Proof by contradiction. If $(I, MUST(P)) \vdash P$, then $MUST(P)$
  would be an IVC for $P$ based on Definition \ref{def:ivc},
  which contradicts Lemma \ref{lem:ivc-must-may}.
\end{proof}
\vspace{2mm}

\begin{lemma}
    \label{lem:must-mustcov}
    $T_i \in MUST(P) \Leftrightarrow T_i \in \mustcov(P)$
\end{lemma}
\begin{proof}
\mike{obvious?}
\end{proof}

Now we focus on the relationship between \nondetcov\ and proof-based metrics.  Given an equational transition system to assign the vertices in the graph, assigning a ``fresh'' input in \nondetcov\ coverage is an isomorphic operation to simply removing the defining equation from the set $T$.  As the variable is no longer constrained by a defining equation, it is effectively an input.

\mike{Should we call this \nondetcov-2 or something?}

\begin{definition} {\emph{Nondeterministic coverage (alternate) (\nondetcov) ~\cite{chockler2010coverage}.} }
\label{def:non-det}
$T_i \in T$ is covered by property $P$ \emph{iff} $T_i \in \nondetcov (P)$, where
$\nondetcov (P) = \{T_i~|~ (I, T) \vdash P \wedge (I, T \setminus \{T_i\}) \nvdash P\}$.
\end{definition}

\noindent Given this definition, it becomes straightforward to define some additional properties.  

\begin{lemma}
  \label{lem:must-coverage}
$T_i \in \nondetcov (P) \Leftrightarrow T_i \in \mustcov(P)$.
\end{lemma}
\begin{proof}
$T_i \in \nondetcov (P)$ means that $(I, S \setminus \{ T_i \}) \nvdash P$ then $T_i$ is necessary to prove $P$ (Lemma \ref{lem:must-not-enough}), which means $T_i \in MUST(P)$.
On the other hand, $MUST(P), T_i \in MUST (P) \Rightarrow T_i \in IVC(P, S)$,
which implies (I, $S \setminus \{ T_i \}) \nvdash P$.
\end{proof}
\vspace{2mm}

In light of Lemma \ref{lem:must-coverage}, the \nondetcov\ coverage score of specification $P$ can be also calculated by
$$\frac{|MUST(P)|}{|T|}$$
%Therefore, for set of properties $\Delta$, the coverage score is computed by $$\frac{|MUST(\Pi)|}{|T|},\quad  \Pi= \bigwedge_{i} {P_i \in \Delta}$$
\vspace{0.2in}


%\mike{after all metrics presented, contrast them on the example.  Introduce the properties HERE and then discuss the coverage sets}
%
%\mike{Then, you can talk about justification, etc.}
\begin{coroll}
\label{cor:must-not-provable}
\nondetcov\ does not preserve provability.
\end{coroll}
\begin{proof}
Immediate from Lemma \ref{lem:must-not-enough} and Lemma \ref{lem:must-coverage}
\end{proof}
\vspace{2mm}
\begin{coroll}
\label{cor:ivc-provable}
\ivccov\ preserves provability.
\end{coroll}
\begin{proof}
Immediate from Definition~\ref{def:minimal-ivc} and Definition \ref{def:coverage-justi}
\end{proof}
\vspace{2mm}

It should be pointed out that \ivccov\ is accurate meaning that it does not result in false positives. In other words, since IVCs are \emph{minimal}, \ivccov\ does not mark
any \emph{actual} uncovered element as covered.

To conclude this section, we should mention that one can define many more proof-based coverage metrics based on the IVC/AIVC idea. Metrics that make use of $AIVC$ relation are computationally more expensive to compute than \ivccov\ although they might be easier to satisfy (i.e. result in higher coverage scores).  

Generally speaking,
in an ascending order of coverage scores,
the proposed coverage metrics can be ranked as follows:
$$\nondetcov\ \leq \ivccov\ \leq \maycov\ \leq \allcov$$
However, \ivccov\ and \nondetcov\ are equivalent when all elements within the model are covered: if all model elements are MUST elements, then there can only be one IVC, and this IVC uses all of the model elements.

Based on our preliminary evaluation, we believe that metrics based on
$AIVC$ relation (like \maycov\ and \allcov) are approximately as computationally expensive as \nondetcov. \footnote{\noindent ~The reason is that \nondetcov\ computes the must set which is also based on $AIVC$ relation. However, in terms of preserving provability, a set of design elements marked as covered by \allcov\ and \maycov\ are
sufficient to reconstruct the proof of the properties.} So, in order to examine the proof-based metrics, Section \ref{sec:impl} considers the implementation of two major notions: \nondetcov\ and
 \ivccov ; because \nondetcov\ is based on a recent work in the literature,
 and among all the other proposed notions, \ivccov\ is the
 one that does not take into account $AIVC$.
 %Besides, in terms of coverage score, \ivccov\ is not too easy (or hard) to satisfy.  