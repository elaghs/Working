\section{Method}
\label{sec:method}

\mike{There is a very close analogue between our notion of SOS (finding minimal model elements) and the notion of mutual vacuity for requirements (maximal strengthenings of requirements); we need to look into this. }

\mike{One interesting question: is there an analogue to the ``strongest passing formula'' work by Chockler as explored in Form Methods Syst Des (2013) 43:552â€“571 DOI 10.1007/s10703-013-0192-6, and a maximal model weakening?  Such a thing would involve changing logical operators within the model rather than simply removing equations.}

[New Intro Here...]

%\subsection{Coverage and Minimal Proofs}
Alternatively, we can consider using the proofs themselves as a mechanism for determining adequacy of requirements.  In this case, we are interested in {\em minimal} sets that satisfy $r$; tracing a requirement to the entire implementation is not particularly enlightening.  We call a minimal set of model elements a \emph{support set} for that requirement, and define the $SOS$ relation to associate support sets to requirements.

$$ \ SOS(r, S) \equiv S \vdash r~ \land   (\neg\exists S'\ .\ S' \subset S \wedge S' \vdash r) $$

$SOS$ maps a requirement to a support set. However, there could be many support sets for a requirement. To capture that notion, we define, \emph{all support sets ($ASOS$)} for a requirement as an association to all its sets of support.


$$ ASOS(r) \equiv  \{\ S~|~S \subseteq \Gamma \land (r,S) \in SOS\ \} $$

In the example in Fig. \ref{fig:ex}, as visualized in part (b),
$ASOS ({\tt P}) = \{\{{\tt P}, {\tt c2}, {\tt c3}\}, \{{\tt P}, {\tt x}, {\tt c3}\}\}$. The set of $ASOS$-es for all requirements represents the complete traceability of the system. Establishing $ASOS$ for a requirement, one gets a clear picture of the all possible ways that requirement is satisfied.

\mike{Do we want to move this later?  It works here, but it is a little bit distracting from the metrics discussion that follows...probably needs a general re-org once we get everything written down}

This information helps categorize each target artifact into one of the following groups for that requirement:

\begin{itemize}
  \item \textbf{MUST} elements - target artifacts that are present in all the support sets for a requirement.
      %$$ MUST_x = \{\forall i (S_xi \in \Sigma_x) \mid \bigcap S_xi \}$$
      $$ MUST (r) = \bigcap \ ASOS(r) $$

  \item \textbf{MAY} elements - target artifacts that are used in some, but not all, support sets.
      $$MAY(r) = (\bigcup ASOS (r)) \setminus MUST (r) $$

  \item \textbf{IRRELEVANT} elements - target artifacts that are not in any of the support sets. $$IRR(r) = \Gamma \setminus (\bigcup ASOS (r))$$
\end{itemize}

Given requirement $r$, functions MUST, MAY, and IRR partition set $\Gamma$ into three disjoint sets \emph{must}, \emph{may}, and \emph{irrelevant}, respectively. This categorization helps to identify the role and relevance of each target artifact in satisfying a requirement. The \emph{must} set contains those target artifacts that are absolutely necessary for the requirement satisfaction. Hence, any change to these elements will most likely impact on each other. On the other hand, elements in the \emph{may} set indicate those target artifacts that satisfy the requirement in one of the possible ways.  Any change to just one of these elements will not affect the satisfaction of that requirement. The IRR function maps a requirement to the elements that never affect the satisfaction of the requirement \cite{Murugesan16:renext}. As an example, the relationships are illustrated graphically in Fig.~\ref{fig:ex} (b). As you can see, in this example,
\emph{must} $= \{ {\tt P}, {\tt c3}\}$ ,
\emph{may} $= \{ {\tt x}, {\tt c2}\}$, and \emph{irrelevant} $= \{ {\tt c1}, {\tt r1}, {\tt r2}\}$.

This view of coverage-as-proof induces several possible coverage scores.  For the moment, we take the parsimonious view: we return the set of different coverage scores induced by the $ASOS$es of all requirements

\[
   Sc_{\vdash 1}(\Gamma, \Delta) = \{~T \in ASOS(\Gamma)~|~\frac{ | T |}{|\Gamma|}~\}
\]

We believe Definition \ref{def:coverage1} characterizes coverage in a way which is both expensive to compute and difficult to satisfy (i.e. it usually leads to low coverage scores). This section proposes a novel notion of coverage which is not only more efficient and practical to compute but also  is an immediate guidance of what is necessary for specification.

First, let state the relationship between the most recent coverage notions in formal verification and the idea of support sets.

\begin{lemma}
  \label{lem:sos-must-may}
 $\forall S \in SOS(r)$, $S$ can be partitioned into two disjoint sets $S_1$ and $S_2$
  such that $S_1 = MUST(r)$ and $S_2 \subseteq MAY(r)$.
\end{lemma}
\begin{proof}
 From the definition of $ASOS$ and $MUST$, $MUST(r) \subseteq S$, for $(r, S) \in SOS$. And
 by definition, $MUST(r) \cap MAY(r) = \varnothing$. Following the definition of $SOS$
 and $MAY$, $S = (MAY(r) \cap S) \cup MUST(r)$.
\end{proof}
\vspace{2mm}

\begin{lemma}
  \label{lem:must-not-enough}
  If $MAY(r) \neq \varnothing$, then $MUST(r) \nvdash r$.
\end{lemma}
\begin{proof}
 Immediate from Lemma \ref{lem:sos-must-may}, and the definition of $SOS$ and provability.
\end{proof}
\vspace{2mm}

\begin{lemma}
  \label{lem:must-coverage}
  Given function $\psi_{sm}(r, \varphi)$, $\forall \varphi \in \Gamma$ iff
  $\psi_{sm} (r) \preccurlyeq \varphi$ then  $\varphi \in MUST(r)$.

\end{lemma}
\begin{proof}
 From the definition of $MUST(r), \forall \varphi \in MUST (r)$, $\forall S \subseteq \Gamma$. $(r, S) \in SOS \Rightarrow \varphi \in SOS(r, S)$,
 which implies $f_m (S \setminus \{ \varphi \}) \nvdash r$.
 On the other hand, considering the definition of $\psi_{sm}$, if
 $f_m (S \setminus \{ \varphi \}) \nvdash r$ then $\varphi$ is necessary to prove $r$ (Lemma \ref{lem:must-not-enough}), which means $\varphi \in MUST(r)$.
\end{proof}
\vspace{2mm}

In light of Lemma \ref{lem:must-coverage}, the coverage score of specification $r$ obtained based on $\psi_{sm}$ can be also calculated by
$$\frac{|MUST(r)|}{|\Gamma|}$$
Therefore, for set of requirements $\Delta$, the coverage score is computed by $$\frac{|MUST(R)|}{|\Gamma|},\xspace  R = \bigwedge_{i} {r_i \in \Delta}$$

\begin{definition} {\emph{Justifiable notion of coverage:}} \\
  \label{def:coverage-ivc}
  Given $R = \bigwedge_{i} {r_i \in \Delta}$ and $S \in ASOS(R)$, justifiable coverage is formalized with function $\psi$ such that  $\forall \varphi \in S$. $\psi (R) \preccurlyeq \varphi$
  and $\forall \lambda \notin S$. $\psi (R) \nprec \lambda$.
\end{definition}
\vspace{2mm}

For the sake of simplicity, we refer to the coverage function
formalized in Definition \ref{def:coverage-ivc} as $\psi_{sos}$.

We call Definition \ref{def:coverage-ivc} \emph{justifiable} because, with a set of the model elements marked as covered by $\psi_{sos}$, every $r \in \Delta$ is provable, whereas a set of covered elements obtained from $\psi_{sm}$ is not sufficient to reconstruct the proofs of requirements in $\Delta$.\footnote{Throughout the paper, when a coverage function is justifiable, like $\psi_{sos}$, it is said that it preserves provability of the requirement.}
This leads the coverage score for $\psi_{sos}$ to be usually higher than the score for $\psi_{sm}$. Coverage score for $\psi_{sos}$ can be calculated with $$\frac{|S|}{|\Gamma|}$$

\begin{theorem}
\label{thm:cov-must}
Given $C = \{\varphi | \varphi \in \Gamma \wedge \psi_{sm} \preccurlyeq \varphi \}$
and \\ $R = \bigwedge_{i} {r_i \in \Delta}$, $C \nvdash R$.
\end{theorem}
\begin{proof}
Immediate from Lemma \ref{lem:must-not-enough} and Lemma \ref{lem:must-coverage}.
\end{proof}
\vspace{2mm}
Theorem \ref{thm:cov-must} demonstrates that $\psi_{sm}$ does not preserve provability.
With Theorem \ref{thm:cov-sos} and Corollary \ref{cor:cov-sos},
we show $\psi_{sos}$ maintains provability of all the requirements.
Theorem \ref{thm:sos-r} proves the sound relationship
between $\psi_{sos}$ and minimal support sets.
It emphasizes that $\psi_{sos}$ is accurate meaning that it does not result in false positives
(i.e. does not assign \emph{actual} uncovered elements to covered) because $SOS$ is \emph{minimal}.

\begin{theorem}
\label{thm:cov-sos}
Given $C = \{\varphi | \varphi \in \Gamma \wedge  \psi_{sos} \preccurlyeq \varphi \}$
and \\ $R = \bigwedge_{i} {r_i \in \Delta}$, $C \vdash R$.
\end{theorem}
\begin{proof}
By Definition, $\psi_{sos} \preccurlyeq \varphi_i$ implies that $\exists S_i \in ASOS(R)$. $\varphi_i \in S_i$.
In addition, since $(R, S_i) \in SOS \Rightarrow S_i \vdash R$, and the union of such $S_i$ sets
forms $C$,
$C \vdash R$.
\end{proof}
\vspace{2mm}

\begin{coroll}
\label{cor:cov-sos}
Given $C = \{\varphi | \varphi \in \Gamma \wedge  \psi_{sos} \preccurlyeq \varphi \}$, \\
$\forall r_i \in \Delta$. $C \vdash r_i$.
\end{coroll}
\begin{proof}
Immediate from Theorem \ref{thm:cov-sos}.
\end{proof}
\vspace{2mm}

\begin{theorem}
\label{thm:sos-r}
If $\psi_{sos} \preccurlyeq \varphi$ then $\exists r \in \Delta$, $S \in ASOS(r)$.
$S \setminus \{\varphi \} \nvdash r$.
\end{theorem}
\begin{proof}
Immediate from Corollary \ref{cor:cov-sos} and the definition of $ASOS$ and provability.
\end{proof}
\vspace{2mm}
To illustrate concepts described in this section, we use the the example in Fig. \ref{fig:ex};
using $\psi_{sos}$, either \{{\tt P}, {\tt c2}, {\tt c3}\} or
 \{{\tt P}, {\tt x}, {\tt c3}\} will be considered as covered. Note that
 $\psi_{sos}$ cannot detect {\tt c2} and {\tt x} as covered simultaneously.
 The fact that which of them will be marked as covered depends on
 the path chosen by the solver to prove {\tt P}. In other words,
 if the proof of {\tt P} is established through the elements of \{{\tt P}, {\tt x}, {\tt c3}\},
 then {\tt x} is covered. Otherwise, since there are only two proof paths (or $SOS({\tt P})$-es)
 here, {\tt c2} would be considered covered. However, this is less restrictive than $\psi_{sm}$ whereby only $MSUT({\tt P})$ is covered. In Section \ref{sec:discussion}, we will provide some other coverage notions to address this issue.
 Another important difference between $\psi_{sm}$ and $\psi_{sos}$ is that, unlike $\psi_{sm}$,
 $\psi_{sos}$ preserves provability. In our example, no matter which $SOS$ will be used;
 in both cases, the set of covered elements by $\psi_{sos}$ is sufficient to re-construct a proof of {\tt P}.
 However, as you can see, the covered set of elements obtained from $\psi_{sm}$ is not
 enough to establish a proof for the validity of {\tt P}.
