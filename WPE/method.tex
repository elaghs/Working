\newcommand{\minproofcov}{\text{\sc MinProof-Cov}}


\section{Proof-Based Metrics}
\label{sec:method}

In this section, we propose a new approach for measuring property completeness based on proof rather than mutation.  We first define notation, then describe different possible metrics given a set of {\em minimal proofs}.  In this section, we do not describe how these proofs are discovered, but define an implementation for transition systems in Section~\ref{sec:impl}.
%\subsection{Coverage and Minimal Proofs}
%Alternatively, we can consider using the proofs themselves as a mechanism for determining adequacy of requirements.

\begin{definition} {\emph{Justifiable coverage (\ivccov):}} \\
\label{def:coverage-justi}
Given $S \in AIVC(P)$, $T$ is covered by $P$ iff $T_i \in \ivccov (P, S)$, where 
$\ivccov (P, S) = \{ T_i \in T ~|~ T_i \in S \}$.
%Given $S \in AIVC(P)$, $T_i \in T$ is covered by $P$ iff  $T_i \in S$,
%denoted by $T_i \in \ivccov (P, S)$
\end{definition}
\vspace{2mm}

%For the sake of simplicity, we refer to the coverage function
%formalized in Definition \ref{def:coverage-justi} as \ivccov\.
%
We call Definition \ref{def:coverage-justi} \emph{justifiable} because, with a set of the model elements marked as covered by \ivccov, $P$ is provable, whereas a set of covered elements obtained from \nondetcov\ may not be sufficient to reconstruct the proof of the property.\footnote{Throughout the paper, when a coverage metric is justifiable, like \ivccov, it is said that it preserves provability of the property.}
This leads the coverage score for \ivccov\ to be usually higher than the score for \nondetcov. Coverage score for \ivccov\ can be calculated with: $$\frac{|S|}{|T|}$$ 
Note that this view of coverage-as-proof induces several possible coverage scores. Because $P$ may have multiple IVCs, there can be a range of scores (with equal justification) for the \ivccov\ metric, which is shown by \minproofcov:
\[
   \minproofcov(T, P) = \{~\frac{ |S|}{|T|}~|~S \in AIVC(P)~\}
\]

Since the primary goal of
 this paper has been to provide a complementary coverage notion in
  formal verification, it is worth exploring other possible notions based on the idea of provability and $AIVC$, which is beneficial, as with testing, because if a coverage notion is an over-approximation, when the coverage
 is high, it does not necessarily mean the quality of
 the specification (or test suite) is high, or when it is an under-approximation, a low coverage score does not always mean the specification is of poor quality.

\begin{definition} {\emph{Complementary coverage notion (\maycov):}}
  \label{def:comp-1} 
 $T_i \in T$ is covered by $P$ iff $T_i \in \maycov (P)$, where
   $\maycov (P) = \{T_i \in T ~|~ (\exists S \in AIVC(P))[T_i \in S] \}$.
\end{definition}

\begin{definition} {\emph{Complementary coverage notion (\allcov):}}
  \label{def:comp-2} 
     Given a set of properties $\Delta$ over $T$, $T_i \in T$ is covered
   iff $T_i \in \allcov (T)$, where
   $\allcov (T) = \{T_i \in T ~|~ (\exists P \in \Delta)[T_i \in AIVC(P)] \}$.
\end{definition}

It should be pointed out that one can define many more proof-based coverage metrics based on the IVC notion. However, the complementary metrics that make use of $AIVC$ relation are computationally much more expensive than \ivccov\ although they might be easier to satisfy. Based on our preliminary evaluation, we believe such metrics are as nearly expensive as \nondetcov. However, in terms of preserving provability, a set of design elements marked as covered by the complementary notions are
sufficient to reconstruct the proof of the properties.

%For the moment, we take the parsimonious view: we return the set of different coverage scores induced by the $AIVC$es of all requirements

\subsection{Discussion}
\label{subsec:method-disc}

Considering $IVC$ and $AIVC$ relations for $P$, model elements can be categorized into one of the following groups:

\begin{itemize}
  \item \textbf{MUST} elements - target artifacts that are present in all the IVC sets of a specification.
      %$$ MUST_x = \{\forall i (S_xi \in \Sigma_x) \mid \bigcap S_xi \}$$
      \[
      MUST (P) = \bigcap AIVC(P)
      \]

  \item \textbf{MAY} elements - target artifacts that are used in some, but not all, IVC sets.
      \[
      MAY(P) = (\bigcup AIVC (P)) \setminus MUST (P)
      \]

  \item \textbf{IRRELEVANT} elements - target artifacts that are not in any of the IVC sets.
  $$IRR(P) = T \setminus (\bigcup AIVC (P)$$
\end{itemize}

Given property $P$, functions MUST, MAY, and IRR partition the target artifacts (set $T$) into three disjoint sets \emph{must}, \emph{may}, and \emph{irrelevant}, respectively. This categorization helps to identify the role and relevance of each target artifact in satisfying a property. The \emph{must} set contains those target artifacts that are absolutely necessary for the property satisfaction.  Any change to these elements will affect provability of the property. On the other hand, any single element in the \emph{may} set may be modified without affecting provability of the property (though modifying multiple elements may require re-proof).   The \emph{irrelevant} artifacts never affect the satisfaction of the property \cite{Murugesan16:renext}.

Based on the above categorization, we will state some relationships about IVCs so to compare different proof-based metrics proposed earlier.

\begin{lemma}
  \label{lem:ivc-must-may}
 $IVC(P, S) \Rightarrow  MUST(P) \subseteq S$.
\end{lemma}
\begin{proof}
 Immediate from the definition of $AIVC$ and $MUST$.
\end{proof}
\vspace{2mm}

\begin{lemma}
  \label{lem:must-not-enough}
  If $MAY(P) \neq \varnothing$, then $P$ is not provable by $MUST(P)$.
\end{lemma}
\begin{proof}
  Proof by contradiction. If $(I, MUST(P)) \vdash P$, then $MUST(P)$
  would be an IVC for $P$ based on Definition \ref{def:ivc},
  which contradicts Lemma \ref{lem:ivc-must-may}.
\end{proof}
\vspace{2mm}

\begin{lemma}
  \label{lem:must-coverage}
$T_i \in \nondetcov (P) \Leftrightarrow T_i \in MUST(P)$.
\end{lemma}
\begin{proof}
$T_i \in \nondetcov (P)$ means that $(I, S \setminus \{ T_i \}) \nvdash P$ then $T_i$ is necessary to prove $P$ (Lemma \ref{lem:must-not-enough}), which means $T_i \in MUST(P)$.
On the other hand, $MUST(P), T_i \in MUST (P) \Rightarrow T_i \in IVC(P, S)$,
which implies (I, $S \setminus \{ T_i \}) \nvdash P$.
\end{proof}
\vspace{2mm}

In light of Lemma \ref{lem:must-coverage}, the \nondetcov\ coverage score of specification $P$ can be also calculated by
$$\frac{|MUST(P)|}{|T|}$$
%Therefore, for set of properties $\Delta$, the coverage score is computed by $$\frac{|MUST(\Pi)|}{|T|},\quad  \Pi= \bigwedge_{i} {P_i \in \Delta}$$
\vspace{0.2in}


%\mike{after all metrics presented, contrast them on the example.  Introduce the properties HERE and then discuss the coverage sets}
%
%\mike{Then, you can talk about justification, etc.}
\begin{coroll}
\label{cor:must-not-provable}
\nondetcov\ does not preserve provability.
\end{coroll}
\begin{proof}
Immediate from Lemma \ref{lem:must-not-enough} and Lemma \ref{lem:must-coverage}
\end{proof}
\vspace{2mm}
\begin{coroll}
\label{cor:ivc-provable}
\ivccov\ preserves provability.
\end{coroll}
\begin{proof}
Immediate from Definition~\ref{def:minimal-ivc} and Definition \ref{def:coverage-justi}
\end{proof}
\vspace{2mm}

Lemma \ref{lem:ivc-acc} shows that \ivccov\ is accurate meaning that it does not result in false positives. In other words, since IVCs are \emph{minimal}, \ivccov\ does not mark
any \emph{actual} uncovered element as covered.

%\begin{theorem}
%\label{thm:cov-must}
%Given $\Pi = \bigwedge_{i} {P_i \in \Delta}$ and
%$C = \{T_i |\quad T_i \in T \wedge T_i \in \zeta_{nc}(\Pi)\}$,
%$\Pi$ may not be provable by $C$.
%\end{theorem}
%\begin{proof}
%Immediate from Lemma \ref{lem:must-not-enough} and Lemma \ref{lem:must-coverage}.
%\end{proof}
%\vspace{2mm}

%With Theorem \ref{thm:cov-ivc} and Corollary \ref{cor:cov-ivc},
%we show \ivccov\ maintains provability of all the properties.
%Theorem \ref{thm:ivc-r} proves the sound relationship
%between \ivccov\ and minimal IVC sets.
%It emphasizes that \ivccov\ is accurate meaning that it does not result in false positives
%(i.e. does not assign \emph{actual} uncovered elements to covered) because $IVC$ is \emph{minimal}.

%\begin{theorem}
%\label{thm:cov-ivc}
%Given $\Pi = \bigwedge_{i} {P_i \in \Delta}$ and
%$C = \{T_i |\quad T_i \in T \wedge T_i \in \zeta_{ivc}(\Pi) \}$,
%$\Pi$ is provable by $C$.
%\end{theorem}
%\begin{proof}
%By Definition, $T_i \in \zeta_{ivc}(\Pi)$ implies that $\exists S_i \in AIVC(\Pi)$. $T_i \in S_i$.
%In addition, since we have $IVC(\Pi, S_i)$ then $\Pi$ is provable by $S_i$. The union of such $S_i$ sets
%forms $C$;
%therefore $\Pi$ is provable by $C$.
%\end{proof}
%\vspace{2mm}

%\begin{coroll}
%\label{cor:cov-ivc}
%Given $\Pi = \bigwedge_{i} {P_i \in \Delta}$ and
%$C = \{T_i |\quad T_i \in T \wedge T_i \in \zeta_{ivc}(\Pi)\}$,
%$\forall P_i \in \Delta$. $C \vdash P_i$.
%\end{coroll}
%\begin{proof}
%Immediate from Theorem \ref{thm:cov-ivc}.
%\end{proof}
%\vspace{2mm}
%
\begin{lemma}
\label{lem:ivc-acc}
If $T_i \in \ivccov(\Pi, S)$, where $\Pi = \bigwedge_{i} {P_i \in \Delta}$, then $\exists P \in \Delta$ and $\exists S \in AIVC(P)$ such that $P$ is not provable by $S \setminus \{T_i \}$.
\end{lemma}
\begin{proof}
Immediate form the fact that $IVC (\Pi, S)$ preserves provability of $\Pi$ and every $P_i \in \Delta$.
\end{proof}
\vspace{2mm}

 %Another important difference between \nondetcov\ and \ivccov\ is that, unlike \nondetcov\,
% \ivccov\ preserves provability. In our example, no matter which $IVC$ will be used;
% in both cases, the set of covered elements by \ivccov\ is sufficient to re-construct a proof of {\tt P}.
% However, as you can see, the covered set of elements obtained from \nondetcov\ is not
% enough to establish a proof for the validity of {\tt P}.


